(function(e,b,d){var f=b.setTransform,a=[1,0,0,1,0,0],c=function(k,j,g,i,h){var o=k.ctx,p=g||a,m={canim:k,img:j,_delay:i||0,_duration:h,angle:0,_start:p,_m:[1,0,0,1,p[4],p[5]],_stop:false},l=function(q,r){return[q[0]*r[0]+q[2]*r[1],q[1]*r[0]+q[3]*r[1],q[0]*r[2]+q[2]*r[3],q[1]*r[2]+q[3]*r[3],q[0]*r[4]+q[2]*r[5]+q[4],q[1]*r[4]+q[3]*r[5]+q[5]]},n=function(q){var t=Math.cos(q),r=Math.sin(q);return[t,-r,r,t,0,0]};m.end=function(){return l(m._m,n(m.angle))};m.next=function(q){return m.stop().canim.sprite(j,m.end(),m._delay+m._duration,q)};m.getTransform=function(s){var v=m._delay,u=m._duration,r=u==0?1:(s-v)/u,q=m._m;r=r>1?1:m._ease(r);return l(m._start.map(function(w,t){return(q[t]-w)*r+w}),n(m.angle*r))};m.transform=function(r,q){q?m._start=l(m._start,r):m._m=l(m._m,r);return m};m.rotate=function(s,q){q?m._start=l(m._start,n(s)):m.angle+=s;return m};m.scale=function(s,r,q){return m.transform([s,0,0,r||s,0,0],q)};m.moveTo=m.move=m.translate=function(q,s,r){return m.transform([1,0,0,1,q,s],r)};m.start=function(q,r){m.move(q,r,true);return m.move(q,r)};m.setTransform=function(q){m._m=q;return m};m.delay=function(q){m._delay=q;return m};m.duration=function(q){m._duration=q;return m};m.stop=function(){m._stop=true;return m};m.ease=function(q){m._ease=new d(q);return m};m.draw=function(){if(k.current<m._delay||(m._stop&&k.current>m._delay+m._duration)){return}b.transform.apply(o,m.getTransform(k.current));if(typeof j=="function"){j.call(k,o)}else{o.drawImage(j,-j.naturalWidth/2,-j.naturalHeight/2)}};return m};b.scene=function(r,g,h,s,k,o,u){var j=function(){return new Date().getTime()/1000},t=this,i=t.canvas,n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(v){e.setTimeout(v,1000/60)},p={ctx:t,begin:j(),end:k,sprites:o||[]},m=function(){i.width=h;i.height=s;f.apply(t,a);t.clearRect(0,0,h,s)},q=function(){p.current=j()-p.begin;if(p.end&&p.current>=p.end){return}m();p.sprites.forEach(function(v){f.apply(t,p.t);v.draw()});n(q)},l=function(){var v=h,y=s,z=v/y,x=r/g,B=v/r,A=y/g;p.t=z>x?[B,0,0,B,0,(y-v/x)/2]:[A,0,0,A,(v-y*x)/2,0]};p.start=function(){q()};p.sprite=function(v,z,w,y){var x=c(p,v,z,w,y);p.sprites.push(x);return x};l(),m(),u&&q();return p}})(window,CanvasRenderingContext2D.prototype,window.Ease||function(){return function(a){return a}});